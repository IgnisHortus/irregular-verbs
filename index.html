<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –≥–ª–∞–≥–æ–ª—ã ‚Äî –æ–±—É—á–µ–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞</title>
<style>
  :root{
    /* –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –ø–∞–ª–∏—Ç—Ä–∞ */
    --bg:#f8f9fe;
    --card:#ffffff;
    --muted:#6b7280;
    --text:#111827;
    --accent:#4f46e5;     /* —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π */
    --accent-light: #e0e7ff;
    --accent-2:#10b981;   /* –∑–µ–ª—ë–Ω—ã–π (—É—Å–ø–µ—Ö) */
    --accent-2-light: #d1fae5;
    --danger:#ef4444;     /* –∫—Ä–∞—Å–Ω—ã–π (–æ—à–∏–±–∫–∞) */
    --danger-light: #fee2e2;
    --warn:#f59e0b;
    --border:rgba(17,24,39,.1);
    --shadow: 0 4px 6px -1px rgba(0,0,0,.07), 0 2px 4px -2px rgba(0,0,0,.07);
    --shadow-lg: 0 10px 15px -3px rgba(0,0,0,.08), 0 4px 6px -4px rgba(0,0,0,.08);
    --radius: 16px;
  }

  @keyframes gradient-animation {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }

  @keyframes fadeInUp {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  @keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.03); }
  }

  *{box-sizing:border-box; transition: background-color .2s, color .2s;}
  body{
    margin:0;
    background: linear-gradient(300deg, #e0e7ff, #f3e8ff, var(--bg));
    background-size: 200% 200%;
    animation: gradient-animation 20s ease infinite;
    color:var(--text);
    font:500 16px/1.5 "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    display:grid; place-items:center; min-height:100dvh; padding:24px;
  }
  .wrap{
    width:100%; max-width:1200px;
    height: 85vh; max-height: 800px;
    background:rgba(255,255,255,.6);
    backdrop-filter: blur(20px) saturate(1.5);
    border:1px solid rgba(255,255,255,.8);
    border-radius:24px; box-shadow:var(--shadow-lg);
    display:grid; grid-template-rows:auto auto 1fr auto;
    overflow:hidden;
  }
  header{
    display:flex; align-items:center; gap:12px; padding:18px 24px;
    border-bottom:1px solid var(--border);
  }
  header .logo{font-weight:800; font-size:18px;}
  header .subtitle{color:var(--muted); font-weight:600; font-size:14px; margin-left:auto;}

  nav.tabs{display:flex; gap:8px; padding:12px 20px;}
  .tab{
    appearance:none; border:none; padding:10px 18px; border-radius:12px; color:var(--text);
    background:transparent; cursor:pointer; font-weight:700; font-size:16px;
    transition: all .2s ease-in-out;
  }
  .tab:hover{background:var(--accent-light); color: var(--accent);}
  .tab[aria-selected="true"]{background:var(--accent); color:white; box-shadow: var(--shadow);}

  .panels{position:relative; overflow:hidden;}
  .panel{position:absolute; inset:0; overflow:auto; padding:16px 24px; animation: fadeInUp .4s ease-out; display:none}
  .panel.active{display:block}

  .rule{background:var(--card); border:1px solid var(--border); border-radius:var(--radius); padding:16px; margin-bottom:16px; box-shadow:var(--shadow)}
  .rule h3{margin:0 0 6px 0; font-size:16px}
  .rule p{margin:0; color:var(--muted)}

  .groups{display:grid; grid-template-columns:repeat(auto-fit, minmax(320px, 1fr)); gap:16px; padding-top: 10px;}
  details.group{background:var(--card); border:1px solid var(--border); border-radius:var(--radius); overflow:hidden; box-shadow:var(--shadow); transition: all .3s ease;}
  details.group[open]{box-shadow:var(--shadow-lg);}
  details.group summary{
    cursor:pointer; list-style:none; padding:14px 18px; font-weight:800; font-size:17px;
    display:flex; align-items:center; gap:8px; background:linear-gradient(180deg, #fff, #fcfcff);
    transition: background-color .2s;
  }
  details.group summary::-webkit-details-marker {display: none;}
  details.group summary:hover{background-color: #f7f8ff;}
  .count{color:var(--accent); font-weight:800}
  .openfs{
    margin-left:auto; border:1px solid var(--border); background:#fff; border-radius:10px;
    padding:6px 10px; font-weight:800; cursor:pointer; transition: all .2s ease;
  }
  .openfs:hover{background:#f3f6ff; transform:scale(1.05);}

  .tbl{width:100%; border-collapse:collapse}
  .tbl th,.tbl td{padding:10px 12px; border-bottom:1px solid var(--border); vertical-align:top; text-align:left;}
  .tbl th{position:sticky; top:-1px; background:#f9fafb; z-index:1; font-size:13px; color:var(--muted)}
  .tbl tr:last-child td{border-bottom:none;}
  .tbl tr:hover td{background:rgba(79,70,229,.04)}
  .tag{display:inline-block; padding:2px 8px; border-radius:999px; font-size:14px; color:var(--accent); background:var(--accent-light); font-weight: 600;}

  .fs{position:absolute; inset:0; background:var(--bg); display:none; grid-template-rows:auto 1fr; z-index:5;}
  .fs.show{display:grid; animation:fadeInUp .3s;}
  .fsbar{display:flex; align-items:center; gap:10px; padding:14px 18px; background:#ffffff; border-bottom:1px solid var(--border)}
  .fsbar .title{font-weight:900; font-size: 18px;}
  .fsbar .count{color:var(--muted)}

  .btn{
    appearance:none; border:1px solid var(--border); background:#fff; border-radius:12px;
    padding:10px 18px; cursor:pointer; font-weight:700; color:var(--text);
    transition: all .2s ease-in-out; box-shadow: var(--shadow);
  }
  .btn:hover{transform:translateY(-2px); box-shadow:var(--shadow-lg)}
  .btn:active{transform:translateY(-1px) scale(.98); box-shadow:var(--shadow)}
  .btn.primary{background:var(--accent-light); border-color:var(--accent); color: var(--accent);}
  .btn.danger{background:var(--danger-light); border-color:var(--danger); color: var(--danger);}

  /* QUIZ */
  .quiz{display:grid; grid-template-rows:auto 1fr auto; gap:16px; height:100%}
  .q-head{
    display:flex; align-items:center; justify-content:space-between; gap:10px;
    border:1px solid var(--border); background:#fff; border-radius:var(--radius);
    padding:12px 16px; box-shadow:var(--shadow); transition: all .3s ease;
  }
  .q-title{font-size:20px; font-weight:800}
  .q-title span{color: var(--accent); font-weight: 900;}
  .hint{display:flex; align-items:center; gap:8px;}

  .grid{display:grid; grid-template-columns:1fr 1fr; gap:16px}
  .col{background:var(--card); border:1px solid var(--border); border-radius:var(--radius); padding:16px; display:grid; grid-template-rows:auto 1fr}
  .col h4{margin:0 0 12px 0; text-align:center; color: var(--muted);}
  .opts{display:grid; grid-auto-rows:minmax(48px, auto); gap:16px; height:100%; align-content:center;}
  .opt{
    border:1px solid var(--border); background:linear-gradient(180deg, #fff, #f9fafb);
    padding:16px 20px; border-radius:14px; cursor:pointer; text-align:center;
    font-weight:800; width:100%; max-width:420px; margin:0 auto;
    font-size:clamp(18px, 2.2vw, 26px); line-height:1.2;
    box-shadow: var(--shadow); transition: all .2s ease-in-out;
  }
  .opt:hover{border-color:var(--accent); transform:scale(1.03);}
  .opt[aria-pressed="true"]{outline:3px solid var(--accent); background:#eef2ff; transform: scale(1.02);}
  .opt.correct{
    outline:3px solid var(--accent-2); background:var(--accent-2-light); color:#065f46;
    animation: pulse .5s;
  }
  .opt.wrong{
    outline:3px solid var(--danger); background:var(--danger-light); color:#991b1b;
  }
  .feedback-icon{font-weight: 900;}
  .feedback-icon.correct{color: var(--accent-2);}
  .feedback-icon.wrong{color: var(--danger);}


  .quiz.ok .q-head{background:var(--accent-2-light); border-color:#a7f3d0}
  .quiz.bad .q-head{background:var(--danger-light); border-color:#fecaca}

  .actions{display:flex; align-items:center; gap:12px}
  .btn.check{background:var(--accent-2-light); border-color:var(--accent-2); color: #047857;}
  .btn.next{background:var(--accent-light); border-color:var(--accent); color: var(--accent);}
  .btn.small{padding:6px 10px; border-radius:10px; box-shadow: none;}
  .score{margin-left:auto; color:var(--muted); font-weight: 600;}

  footer{padding:12px 24px; color:var(--muted); font-size:13px; border-top:1px solid var(--border); background:rgba(255,255,255,0.7)}

  .modal{
    position:absolute; inset:0; display:none; place-items:center;
    background:rgba(17,24,39,.3); backdrop-filter: blur(4px); z-index:10
  }
  .modal.show{display:grid; animation:fadeInUp .3s forwards;}
  .modal .box{
    background:#fff; border:1px solid var(--border); border-radius:var(--radius);
    padding:24px; width:min(560px, 92%); box-shadow:var(--shadow-lg);
  }
  .kpi{display:flex; gap:12px; flex-wrap:wrap}
  .kpi .card{
    flex:1 1 160px; border:1px solid var(--border); background:#f9fafb;
    border-radius:12px; padding:12px
  }
  .kpi .card h5{margin:0 0 6px 0; color:var(--muted);}

  @media (max-width: 900px) {
    body { padding: 0; }
    .wrap { border-radius: 0; height: 100dvh; max-height: none; }
    .groups{grid-template-columns:1fr}
    .grid{grid-template-columns:1fr; gap: 10px;}
    .opt{max-width:100%}
    .q-title { font-size: 16px; }
  }
</style>
</head>
<body>
  <div class="wrap" role="application">
    <header>
      <div class="logo">üìöüß† <span style="margin-left:6px; font-weight:900">–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –≥–ª–∞–≥–æ–ª—ã</span></div>
      <div class="subtitle">–æ–±—É—á–µ–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞</div>
    </header>

    <nav class="tabs" role="tablist" aria-label="–†–µ–∂–∏–º—ã">
      <button class="tab" role="tab" aria-selected="true" data-tab="learn">üéì –û–±—É—á–µ–Ω–∏–µ</button>
      <button class="tab" role="tab" aria-selected="false" data-tab="quiz">‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞</button>
    </nav>

    <div class="panels">
      <section id="panel-learn" class="panel active" role="tabpanel" aria-labelledby="learn">
        <div class="rule"><h3>–ö–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω–æ</h3>
          <p>–ì–ª–∞–≥–æ–ª—ã —Ä–∞–∑–¥–µ–ª–µ–Ω—ã –Ω–∞ –≥—Ä—É–ø–ø—ã –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –∑–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –≥—Ä—É–ø–ø—ã, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –∏–ª–∏ —Å–∫—Ä—ã—Ç—å —Å–ø–∏—Å–æ–∫ –≥–ª–∞–≥–æ–ª–æ–≤.</p>
        </div>

        <div class="groups" id="groups"></div>

        <div id="fs" class="fs" aria-hidden="true" role="dialog" aria-modal="true">
          <div class="fsbar">
            <button class="btn" id="fsBack">‚¨ÖÔ∏è –ù–∞–∑–∞–¥</button>
            <div class="title" id="fsTitle"></div>
            <div class="count" id="fsCount"></div>
            <button class="btn danger" id="fsClose" style="margin-left:auto">‚úñ –ó–∞–∫—Ä—ã—Ç—å</button>
          </div>
          <div class="fscontent" id="fsContent"></div>
        </div>
      </section>

      <section id="panel-quiz" class="panel" role="tabpanel" aria-labelledby="quiz">
        <div class="quiz" id="quiz">
          <div class="q-head">
            <div class="q-title">–í—ã–±–µ—Ä–∏ —Ñ–æ—Ä–º—ã –¥–ª—è: <span id="qInf"></span></div>
            <div class="hint">
              <span id="qRu" class="tag"></span>
              <button class="btn small" id="toggleRu" title="–ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –ø–µ—Ä–µ–≤–æ–¥">üëÅÔ∏è‚Äçüó®Ô∏è</button>
            </div>
          </div>

          <div class="grid">
            <div class="col">
              <h4>2‚Äë—è —Ñ–æ—Ä–º–∞ (Past Simple)</h4>
              <div class="opts" id="optsPS" role="group" aria-label="–í–∞—Ä–∏–∞–Ω—Ç—ã 2‚Äë–π —Ñ–æ—Ä–º—ã"></div>
            </div>
            <div class="col">
              <h4>3‚Äë—è —Ñ–æ—Ä–º–∞ (Past Participle)</h4>
              <div class="opts" id="optsPP" role="group" aria-label="–í–∞—Ä–∏–∞–Ω—Ç—ã 3‚Äë–π —Ñ–æ—Ä–º—ã"></div>
            </div>
          </div>

          <div class="actions">
            <button class="btn check" id="btnCheck">–ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç üìä</button>
            <button class="btn next" id="btnNext" title="–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å ‚û°Ô∏è</button>
            <div class="score" id="score">–ü—Ä–∞–≤–∏–ª—å–Ω–æ: 0 / 0</div>
          </div>
        </div>
      </section>
    </div>

    <footer>üí° –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ –æ–¥–Ω–æ–º—É –≤–∞—Ä–∏–∞–Ω—Ç—É –≤ –∫–∞–∂–¥–æ–º —Å—Ç–æ–ª–±—Ü–µ, –∏ –æ—Ç–≤–µ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.</footer>
  </div>

  <div class="modal" id="modal">
    <div class="box">
      <h3 style="margin:0 0 14px 0">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</h3>
      <div class="kpi">
        <div class="card"><h5>–í—Å–µ–≥–æ –∑–∞–¥–∞–Ω–∏–π</h5><div id="mTotal" style="font-size:24px; font-weight:900">0</div></div>
        <div class="card"><h5>–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤</h5><div id="mCorrect" style="font-size:24px; font-weight:900; color:var(--accent-2)">0</div></div>
        <div class="card"><h5>–¢–æ—á–Ω–æ—Å—Ç—å</h5><div id="mAcc" style="font-size:24px; font-weight:900">0%</div></div>
      </div>
      <div style="display:flex; gap:10px; margin-top:20px">
        <button class="btn primary" id="mClose">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
        <button class="btn danger" id="mReset">–°–±—Ä–æ—Å–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</button>
      </div>
    </div>
  </div>

<script>
// ---- –î–∞–Ω–Ω—ã–µ ----
const VERBS = [
  ["become","became","become","—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è"],["come","came","come","–ø—Ä–∏—Ö–æ–¥–∏—Ç—å"],["run","ran","run","–±–µ–∂–∞—Ç—å, —Ç–µ—á—å"],
  ["be","was/were","been","–±—ã—Ç—å"],["bear","bore","born/borne","–ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—å"],["begin","began","begun","–Ω–∞—á–∏–Ω–∞—Ç—å"],["can","could","-","–º–æ—á—å"],["choose","chose","chosen","–≤—ã–±–∏—Ä–∞—Ç—å"],["do","did","done","–¥–µ–ª–∞—Ç—å"],["draw","drew","drawn","—Ä–∏—Å–æ–≤–∞—Ç—å"],["drink","drank","drunk","–ø–∏—Ç—å"],["drive","drove","driven","–≤–µ—Å—Ç–∏ –º–∞—à–∏–Ω—É"],["eat","ate","eaten","–µ—Å—Ç—å"],["fall","fell","fallen","–ø–∞–¥–∞—Ç—å"],["fly","flew","flown","–ª–µ—Ç–∞—Ç—å"],["forget","forgot","forgotten","–∑–∞–±—ã–≤–∞—Ç—å"],["forgive","forgave","forgiven","–ø—Ä–æ—â–∞—Ç—å"],["freeze","froze","frozen","–∑–∞–º–æ—Ä–∞–∂–∏–≤–∞—Ç—å"],["give","gave","given","–¥–∞–≤–∞—Ç—å"],["go","went","gone","–∏–¥—Ç–∏"],["grow","grew","grown","—Ä–∞—Å—Ç–∏"],["hide","hid","hidden","–ø—Ä—è—Ç–∞—Ç—å"],["know","knew","known","–∑–Ω–∞—Ç—å"],["may","might","-","–º–æ—á—å"],["ring","rang","rung","–∑–≤–æ–Ω–∏—Ç—å"],["rise","rose","risen","–ø–æ–¥–Ω–∏–º–∞—Ç—å—Å—è"],["see","saw","seen","–≤–∏–¥–µ—Ç—å"],["shake","shook","shaken","—Ç—Ä—è—Å—Ç–∏"],["show","showed","shown","–ø–æ–∫–∞–∑—ã–≤–∞—Ç—å"],["sing","sang","sung","–ø–µ—Ç—å"],["speak","spoke","spoken","–≥–æ–≤–æ—Ä–∏—Ç—å"],["steal","stole","stolen","–≤–æ—Ä–æ–≤–∞—Ç—å"],["swim","swam","swum","–ø–ª–∞–≤–∞—Ç—å"],["take","took","taken","–±—Ä–∞—Ç—å"],["throw","threw","thrown","–±—Ä–æ—Å–∞—Ç—å"],["wake","woke","waked/woken","–ø—Ä–æ—Å—ã–ø–∞—Ç—å—Å—è"],["wear","wore","worn","–Ω–æ—Å–∏—Ç—å (–æ–¥–µ–∂–¥—É)"],["write","wrote","written","–ø–∏—Å–∞—Ç—å"],
  ["beat","beat","beaten/beat","–±–∏—Ç—å"],["cost","cost","cost","—Å—Ç–æ–∏—Ç—å"],["cut","cut","cut","—Ä–µ–∑–∞—Ç—å"],["hit","hit","hit","—É–¥–∞—Ä—è—Ç—å"],["hurt","hurt","hurt","–ø—Ä–∏—á–∏–Ω—è—Ç—å –±–æ–ª—å"],["let","let","let","–ø–æ–∑–≤–æ–ª—è—Ç—å"],["put","put","put","–∫–ª–∞—Å—Ç—å"],["read","read","read","—á–∏—Ç–∞—Ç—å"],["set","set","set","—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å"],["shut","shut","shut","–∑–∞–∫—Ä—ã–≤–∞—Ç—å"],["spread","spread","spread","—Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è—Ç—å"],
  ["bite","bit","bit/bitten","–∫—É—Å–∞—Ç—å"],["bring","brought","brought","–ø—Ä–∏–Ω–æ—Å–∏—Ç—å"],["build","built","built","—Å—Ç—Ä–æ–∏—Ç—å"],["burn","burnt","burnt","–∂–µ—á—å"],["buy","bought","bought","–ø–æ–∫—É–ø–∞—Ç—å"],["catch","caught","caught","–ª–æ–≤–∏—Ç—å"],["dream","dreamt","dreamed/dreamt","–º–µ—á—Ç–∞—Ç—å"],["feel","felt","felt","—á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å"],["fight","fought","fought","—Å—Ä–∞–∂–∞—Ç—å—Å—è"],["find","found","found","–Ω–∞—Ö–æ–¥–∏—Ç—å"],["get","got","got","–ø–æ–ª—É—á–∞—Ç—å"],["hang","hung","hanged/hung","–≤–µ—à–∞—Ç—å"],["have","had","had","–∏–º–µ—Ç—å"],["hear","heard","heard","—Å–ª—ã—à–∞—Ç—å"],["hold","held","held","–¥–µ—Ä–∂–∞—Ç—å"],["keep","kept","kept","—Ö—Ä–∞–Ω–∏—Ç—å"],["lead","led","led","–≤–µ—Å—Ç–∏"],["learn","learnt","learnt","–∏–∑—É—á–∞—Ç—å"],["leave","left","left","–æ—Å—Ç–∞–≤–ª—è—Ç—å"],["lend","lent","lent","–æ–¥–∞–ª–∂–∏–≤–∞—Ç—å"],["lose","lost","lost","—Ç–µ—Ä—è—Ç—å"],["make","made","made","–¥–µ–ª–∞—Ç—å"],["mean","meant","meant","–∑–Ω–∞—á–∏—Ç—å"],["meet","met","met","–≤—Å—Ç—Ä–µ—á–∞—Ç—å"],["pay","paid","paid","–ø–ª–∞—Ç–∏—Ç—å"],["say","said","said","–≥–æ–≤–æ—Ä–∏—Ç—å"],["sell","sold","sold","–ø—Ä–æ–¥–∞–≤–∞—Ç—å"],["send","sent","sent","–ø–æ—Å—ã–ª–∞—Ç—å"],["sew","sewed","sewed/sewn","—à–∏—Ç—å"],["shave","shaved","shaved/shaven","–±—Ä–∏—Ç—å—Å—è"],["shine","shone","shone","—Å–≤–µ—Ç–∏—Ç—å"],["shoot","shot","shot","—Å—Ç—Ä–µ–ª—è—Ç—å"],["sit","sat","sat","—Å–∏–¥–µ—Ç—å"],["sleep","slept","slept","—Å–ø–∞—Ç—å"],["spend","spent","spent","—Ç—Ä–∞—Ç–∏—Ç—å"],["stand","stood","stood","—Å—Ç–æ—è—Ç—å"],["sting","stung","stung","–∂–∞–ª–∏—Ç—å"],["strike","struck","struck/stricken","—É–¥–∞—Ä—è—Ç—å"],["sweep","swept","swept","–º–µ—Å—Ç–∏"],["teach","taught","taught","—É—á–∏—Ç—å"],["tell","told","told","—Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞—Ç—å"],["think","thought","thought","–¥—É–º–∞—Ç—å"],["understand","understood","understood","–ø–æ–Ω–∏–º–∞—Ç—å"],["win","won","won","–≤—ã–∏–≥—Ä—ã–≤–∞—Ç—å"],
];
const GROUP_ALL_SAME = new Set(["beat", "cost", "cut", "hit", "hurt", "let", "put", "read", "set", "shut", "spread"]);
const GROUP_1_3_SAME = new Set(["become", "come", "run"]);
const GROUP_2_3_SAME = new Set(["bite", "bring", "build", "burn", "buy", "catch", "dream", "feel", "fight", "find", "get", "hang", "have", "hear", "hold", "keep", "lead", "learn", "leave", "lend", "lose", "make", "mean", "meet", "pay", "say", "sell", "send", "sew", "shave", "shine", "shoot", "sit", "sleep", "spend", "stand", "sting", "strike", "sweep", "teach", "tell", "think", "understand", "win"]);

function splitForms(s){ return s.split(/\s*[\/,]|\s+or\s+/i).map(x=>x.trim()).filter(Boolean); }
const DATA = VERBS.map(([inf, ps, pp, ru])=>({ inf, ps, pp, ru, psList: splitForms(ps), ppList: splitForms(pp) }));
function groupOf(inf){
  if (GROUP_ALL_SAME.has(inf)) return "‚ë† –≤—Å–µ 3 —Å–æ–≤–ø–∞–¥–∞—é—Ç";
  if (GROUP_1_3_SAME.has(inf)) return "‚ë° 1 –∏ 3 —Å–æ–≤–ø–∞–¥–∞—é—Ç";
  if (GROUP_2_3_SAME.has(inf)) return "‚ë¢ 2 –∏ 3 —Å–æ–≤–ø–∞–¥–∞—é—Ç";
  return "‚ë£ –ø—Ä–æ—á–∏–µ";
}

const groupsEl = document.getElementById('groups');
const GROUP_TITLES = ["‚ë† –í—Å–µ 3 —Ñ–æ—Ä–º—ã —Å–æ–≤–ø–∞–¥–∞—é—Ç", "‚ë° –°–æ–≤–ø–∞–¥–∞—é—Ç 1-—è –∏ 3-—è", "‚ë¢ –°–æ–≤–ø–∞–¥–∞—é—Ç 2-—è –∏ 3-—è", "‚ë£ –ü—Ä–æ—á–∏–µ"];
const groupOrder = ["‚ë† –≤—Å–µ 3 —Å–æ–≤–ø–∞–¥–∞—é—Ç","‚ë° 1 –∏ 3 —Å–æ–≤–ø–∞–¥–∞—é—Ç","‚ë¢ 2 –∏ 3 —Å–æ–≤–ø–∞–¥–∞—é—Ç","‚ë£ –ø—Ä–æ—á–∏–µ"];

function renderLearn(){
  const buckets = new Map(groupOrder.map(k=>[k, []]));
  DATA.forEach(v=>buckets.get(groupOf(v.inf)).push(v));
  groupOrder.forEach((key, i)=>{
    const list = buckets.get(key).slice().sort((a,b)=>a.inf.localeCompare(b.inf));
    const details = document.createElement('details');
    details.className = 'group';
    if (i < 2) details.open = true;
    details.innerHTML = `<summary>${GROUP_TITLES[i]} <span class="count">(${list.length})</span><button class="openfs" type="button" aria-label="–û—Ç–∫—Ä—ã—Ç—å –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω">‚§¢</button></summary><div style="padding:0; max-height:320px; overflow:auto">${tableHTML(list)}</div>`;
    const btn = details.querySelector('.openfs');
    btn.addEventListener('click', (e)=>{ e.preventDefault(); e.stopPropagation(); openFS(key); });
    groupsEl.appendChild(details);
  });
}
function tableHTML(list){
  return `<table class="tbl" role="grid"><thead><tr><th>Infinitive</th><th>Past Simple</th><th>Past Participle</th><th>–ü–µ—Ä–µ–≤–æ–¥</th></tr></thead><tbody>${list.map(v=>`<tr><td><strong>${escapeHTML(v.inf)}</strong></td><td>${escapeHTML(v.ps)}</td><td>${escapeHTML(v.pp)}</td><td>${escapeHTML(v.ru)}</td></tr>`).join('')}</tbody></table>`;
}
function escapeHTML(s){ return s.replace(/[&<>]/g, c=>({"&":"&amp;","<":"&lt;",">":"&gt;"}[c])); }

const fsEl = document.getElementById('fs');
const fsTitle = document.getElementById('fsTitle');
const fsCount = document.getElementById('fsCount');
const fsContent = document.getElementById('fsContent');
const fsBack = document.getElementById('fsBack');
const fsClose = document.getElementById('fsClose');

function openFS(groupKey){
  const idx = groupOrder.indexOf(groupKey);
  const title = GROUP_TITLES[idx] || '–†–∞–∑–¥–µ–ª';
  const list = DATA.filter(v=>groupOf(v.inf)===groupKey).sort((a,b)=>a.inf.localeCompare(b.inf));
  fsTitle.textContent = title;
  fsCount.textContent = `(${list.length})`;
  fsContent.innerHTML = tableHTML(list);
  fsEl.classList.add('show');
  fsEl.setAttribute('aria-hidden','false');
}
function closeFS(){ fsEl.classList.remove('show'); fsEl.setAttribute('aria-hidden','true'); }
fsBack.addEventListener('click', closeFS);
fsClose.addEventListener('click', closeFS);
window.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && fsEl.classList.contains('show')) closeFS(); });

// ---- –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ ----
const quizEl = document.getElementById('quiz');
const qInf = document.getElementById('qInf');
const qRu = document.getElementById('qRu');
const toggleRuBtn = document.getElementById('toggleRu');
const optsPS = document.getElementById('optsPS');
const optsPP = document.getElementById('optsPP');
const btnCheck = document.getElementById('btnCheck');
const btnNext = document.getElementById('btnNext');
const scoreEl = document.getElementById('score');
const modal = document.getElementById('modal');
const mTotal = document.getElementById('mTotal');
const mCorrect = document.getElementById('mCorrect');
const mAcc = document.getElementById('mAcc');
const mClose = document.getElementById('mClose');
const mReset = document.getElementById('mReset');

let qTotal=0, qCorrect=0;
let current=null; let selectedPS=null, selectedPP=null;

function pickRandom(arr){return arr[Math.floor(Math.random()*arr.length)];}
function shuffle(arr){ for (let i = arr.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [arr[i], arr[j]] = [arr[j], arr[i]]; } return arr; }

function generatePlausibleVariants(inf) {
    const variants = new Set();
    if (inf.endsWith('e')) variants.add(inf + 'd');
    else if (/[bcdfghjklmnpqrstvwxz]y$/.test(inf)) variants.add(inf.slice(0, -1) + 'ied');
    else variants.add(inf + 'ed');
    if (inf.includes('i')) { variants.add(inf.replace('i', 'a')); variants.add(inf.replace('i', 'u')); }
    if (inf.includes('ow')) { variants.add(inf.replace('ow', 'ew')); }
    if (inf.endsWith('e')) variants.add(inf + 'n'); else variants.add(inf + 'en');
    if(inf === 'bring') { variants.add('brang'); variants.add('brung'); }
    if(inf === 'buy') { variants.add('baught'); }
    return Array.from(variants);
}

function buildOptions(target){
    const correctPS = target.psList[0];
    const correctPP = target.ppList[0];
    
    const distractorsPool = new Set([
        target.inf,
        target.psList[0],
        target.ppList[0],
        ...generatePlausibleVariants(target.inf)
    ]);

    const psPool = [...distractorsPool].filter(d => d && !target.psList.includes(d));
    const psDistractors = shuffle(psPool).slice(0, 2);
    const psOpts = shuffle([correctPS, ...psDistractors]);

    const ppPool = [...distractorsPool].filter(d => d && !target.ppList.includes(d));
    const ppDistractors = shuffle(ppPool).slice(0, 2);
    const ppOpts = shuffle([correctPP, ...ppDistractors]);
    
    renderOptions(optsPS, psOpts, 'ps');
    renderOptions(optsPP, ppOpts, 'pp');
}

function renderOptions(container, options, kind){
  container.innerHTML = '';
  while(options.length < 3) {
      const fallbackVerb = pickRandom(DATA);
      const fallbackForm = kind === 'ps' ? fallbackVerb.psList[0] : fallbackVerb.ppList[0];
      if (fallbackForm && fallbackForm !== '-' && !options.includes(fallbackForm)) {
          options.push(fallbackForm);
      }
  }

  options.forEach(text=>{
    const b = document.createElement('button');
    b.className='opt'; b.type='button'; b.textContent=text;
    b.addEventListener('click',()=>{
      if(quizEl.classList.contains('ok') || quizEl.classList.contains('bad')) return;
      [...container.querySelectorAll('.opt')].forEach(el=>el.setAttribute('aria-pressed','false'));
      b.setAttribute('aria-pressed','true');
      if (kind==='ps') selectedPS = text; else selectedPP = text;
      maybeAutoCheck();
    });
    container.appendChild(b);
  });
}

function newRound(){
  quizEl.classList.remove('ok','bad');
  current = pickRandom(DATA.filter(v => v.ps !== '-'));
  qInf.textContent = current.inf;
  qRu.textContent = current.ru;
  qRu.style.visibility = 'hidden';
  selectedPS = selectedPP = null;
  optsPS.innerHTML = optsPP.innerHTML = '';
  buildOptions(current);
}

function markAfterCheck(){
    const okPS = current.psList.includes(selectedPS);
    const okPP = current.ppList.includes(selectedPP);

    [...optsPS.children].forEach(b => {
        const isCorrect = current.psList.includes(b.textContent);
        const isSelected = b.getAttribute('aria-pressed') === 'true';
        if (isCorrect) b.classList.add('correct');
        if (isSelected && !isCorrect) b.classList.add('wrong');
        if (isSelected) b.innerHTML += ` <span class="feedback-icon ${isCorrect ? 'correct' : 'wrong'}">${isCorrect ? '‚úì' : '‚úó'}</span>`;
    });
    [...optsPP.children].forEach(b => {
        const isCorrect = current.ppList.includes(b.textContent);
        const isSelected = b.getAttribute('aria-pressed') === 'true';
        if (isCorrect) b.classList.add('correct');
        if (isSelected && !isCorrect) b.classList.add('wrong');
        if (isSelected) b.innerHTML += ` <span class="feedback-icon ${isCorrect ? 'correct' : 'wrong'}">${isCorrect ? '‚úì' : '‚úó'}</span>`;
    });

    qTotal++;
    if (okPS && okPP) {
        qCorrect++;
        quizEl.classList.add('ok');
    } else {
        quizEl.classList.add('bad');
    }
    scoreEl.textContent = `–ü—Ä–∞–≤–∏–ª—å–Ω–æ: ${qCorrect} / ${qTotal}`;
    setTimeout(newRound, 1500);
}

function maybeAutoCheck(){
  if(!selectedPS || !selectedPP) return;
  markAfterCheck();
}

btnNext.addEventListener('click', newRound);

btnCheck.addEventListener('click',()=>{
  mTotal.textContent = qTotal;
  mCorrect.textContent = qCorrect;
  const acc = qTotal ? Math.round(qCorrect*100/qTotal) : 0;
  mAcc.textContent = acc + '%';
  modal.classList.add('show');
});

mClose.addEventListener('click',()=> modal.classList.remove('show'));
mReset.addEventListener('click',()=>{
  qTotal=0; qCorrect=0;
  scoreEl.textContent = `–ü—Ä–∞–≤–∏–ª—å–Ω–æ: ${qCorrect} / ${qTotal}`;
  modal.classList.remove('show');
  newRound();
});
toggleRuBtn.addEventListener('click',()=>{
  qRu.style.visibility = qRu.style.visibility === 'hidden' ? 'visible' : 'hidden';
});

// –í–∫–ª–∞–¥–∫–∏
const tabs = document.querySelectorAll('.tab');
const panels = { learn: document.getElementById('panel-learn'), quiz: document.getElementById('panel-quiz') };
tabs.forEach(t=>t.addEventListener('click',()=>{
  tabs.forEach(x=>x.setAttribute('aria-selected','false'));
  t.setAttribute('aria-selected','true');
  const key = t.dataset.tab;
  Object.values(panels).forEach(p=>p.classList.remove('active'));
  panels[key].classList.add('active');
  if(key==='quiz' && !current) newRound();
}));

// init
renderLearn();
</script>
</body>
</html>